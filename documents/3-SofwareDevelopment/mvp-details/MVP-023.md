# MVP-023: AI Agent Creator

**Status**: Not Started  
**Priority**: P1  
**Effort**: Medium  
**Skills Required**: Go, Templ, AI/LLM, Frontend Dev  
**Dependencies**: MVP-025

---

## Objective

Implement an AI-powered conversational interface for creating new agents within an agency context. The AI assistant will ask intelligent questions, resolve ambiguities, suggest configurations, and guide users through agent creation with natural language interaction.

---

## Key Deliverables

### 1. AI Conversational Interface (Chat-based Agent Creator)
- Chat-style modal with AI assistant avatar
- Natural language input for agent specifications
- AI asks clarifying questions about:
  * Agent purpose and role
  * Agent type selection (with suggestions)
  * Required capabilities and behaviors
  * Configuration parameters
  * Location and metadata
- Real-time suggestions and validation
- Preview of agent configuration before creation
- Context-aware recommendations based on agency type

### 2. AI Agent Creation Flow
```
User: "I need an agent to monitor water pressure"

AI: "Great! I'll help you create a pressure monitoring agent. 
     Let me ask a few questions:
     
     1. What should we name this agent? 
        (Suggestion: Pressure-Monitor-Zone-A)"

User: "Pressure Monitor A1"

AI: "Perfect! Now, for pressure monitoring, I recommend a 
     'sensor' type agent. It can:
     - Monitor pressure readings continuously
     - Send alerts when thresholds are exceeded
     - Log historical data
     
     Should I configure it with these capabilities?"

User: "Yes, and alert me if pressure drops below 30 PSI"

AI: "Understood! I've configured:
     âœ“ Agent Type: Sensor
     âœ“ Name: Pressure-Monitor-A1
     âœ“ Alert Threshold: < 30 PSI
     âœ“ Monitoring: Continuous
     
     What location should I assign? (e.g., Zone A, Building 3)"
```

### 3. AI Intelligence Features
- **Intent Recognition**: Understand user's agent requirements from natural language
- **Smart Suggestions**: Recommend agent types based on description
- **Configuration Inference**: Auto-configure based on use case
- **Validation**: Catch incomplete or conflicting requirements
- **Learning**: Improve suggestions based on agency patterns
- **Multi-turn Dialogue**: Handle complex configurations through conversation
- **Ambiguity Resolution**: Ask clarifying questions when needed

### 4. Backend AI Integration
- LLM integration (OpenAI GPT-4, Claude, or local model)
- Agent type knowledge base for recommendations
- Configuration templates for common scenarios
- Prompt engineering for agent creation domain
- Context injection (agency info, existing agents)
- Structured output generation (JSON config)

### 5. Agent Configuration Generation
- AI generates complete agent configuration from conversation
- Validates against agency database schema
- Suggests defaults for optional fields
- Creates unique names if conflicts detected
- Maps natural language to technical parameters
- **Assigns token budget** (default from agent type, customizable)
- Validates token budget â‰¤ agent type budget
- Checks available budget in agent type pool

#### Token Budget Integration
- Each agent receives a token budget upon creation
- Default budget suggested based on agent type
- Budget must be â‰¤ agent type's total budget
- Remaining agent type budget validated before creation
- AI suggests appropriate budget based on agent's expected workload
- Token budget can be adjusted later in admin page (MVP-046)

### 6. API Endpoints
```
POST /api/v1/agencies/{id}/agents/chat         # Send message to AI
POST /api/v1/agencies/{id}/agents/create       # Create from AI-generated config
GET  /api/v1/agencies/{id}/agents/suggestions  # Get AI suggestions
```

---

## UI Mockup Structure

```html
<!-- AI Agent Creator Chat Interface -->
<div class="modal is-active">
  <div class="modal-background"></div>
  <div class="modal-card agent-chat-creator">
    <header class="modal-card-head">
      <div class="media">
        <div class="media-left">
          <span class="icon is-large">ğŸ¤–</span>
        </div>
        <div class="media-content">
          <p class="modal-card-title">AI Agent Creator</p>
          <p class="subtitle is-7">Let me help you create the perfect agent</p>
        </div>
      </div>
      <button class="delete" aria-label="close"></button>
    </header>
    
    <section class="modal-card-body chat-container">
      <!-- Chat Messages -->
      <div class="chat-messages">
        <!-- AI Welcome Message -->
        <div class="message ai-message">
          <div class="message-avatar">ğŸ¤–</div>
          <div class="message-content">
            <p>Hi! I'm your AI assistant for creating agents in the 
               <strong>Water Distribution Network</strong> agency.</p>
            <p>Tell me what kind of agent you need, and I'll help you 
               configure it. For example:</p>
            <ul>
              <li>"Create a sensor to monitor pipe pressure"</li>
              <li>"I need an agent to control pump operations"</li>
              <li>"Set up a leak detection agent for Zone A"</li>
            </ul>
          </div>
        </div>
        
        <!-- User Message Example -->
        <div class="message user-message">
          <div class="message-content">
            I need a sensor to monitor water flow
          </div>
          <div class="message-avatar">ğŸ‘¤</div>
        </div>
        
        <!-- AI Response with Suggestions -->
        <div class="message ai-message">
          <div class="message-avatar">ğŸ¤–</div>
          <div class="message-content">
            <p>Perfect! I'll create a flow monitoring sensor for you.</p>
            <div class="suggestion-box">
              <strong>Suggested Configuration:</strong>
              <ul>
                <li>ğŸ“Š Agent Type: Flow Sensor</li>
                <li>â±ï¸ Update Interval: 30 seconds</li>
                <li>ğŸ¯ Measurement Units: Gallons per minute</li>
              </ul>
            </div>
            <p>What should we name this agent?</p>
            <div class="quick-replies">
              <button class="button is-small is-outlined">
                Flow-Sensor-01
              </button>
              <button class="button is-small is-outlined">
                Main-Flow-Monitor
              </button>
              <button class="button is-small is-outlined">
                Custom name...
              </button>
            </div>
          </div>
        </div>
        
        <!-- Configuration Preview -->
        <div class="message ai-message">
          <div class="message-avatar">ğŸ¤–</div>
          <div class="message-content">
            <p>âœ… All set! Here's your agent configuration:</p>
            <div class="config-preview">
              <div class="columns is-mobile">
                <div class="column">
                  <strong>Name:</strong><br>Flow-Sensor-Zone-A
                </div>
                <div class="column">
                  <strong>Type:</strong><br>Flow Sensor
                </div>
              </div>
              <div class="columns is-mobile">
                <div class="column">
                  <strong>Location:</strong><br>Zone A, Sector 3
                </div>
                <div class="column">
                  <strong>Interval:</strong><br>30 seconds
                </div>
              </div>
            </div>
            <p>Should I create this agent now?</p>
            <div class="action-buttons">
              <button class="button is-success">
                âœ“ Create Agent
              </button>
              <button class="button is-warning">
                âœï¸ Modify Configuration
              </button>
              <button class="button is-light">
                â†©ï¸ Start Over
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Typing Indicator -->
      <div class="typing-indicator" style="display: none;">
        <span></span><span></span><span></span>
      </div>
    </section>
    
    <!-- Chat Input -->
    <footer class="modal-card-foot chat-input-container">
      <div class="field has-addons is-fullwidth">
        <div class="control is-expanded">
          <input class="input" type="text" 
                 placeholder="Describe the agent you need..."
                 id="chat-input">
        </div>
        <div class="control">
          <button class="button is-primary" id="send-message">
            <span class="icon">ğŸ“¤</span>
          </button>
        </div>
      </div>
      <p class="help has-text-centered">
        ğŸ’¡ Tip: Be specific about what you want the agent to do
      </p>
    </footer>
  </div>
</div>
```

---

## AI Conversation Patterns

### 1. Intent Recognition
```
User: "monitor temperature"
AI detects: monitoring + temperature â†’ Sensor agent
```

### 2. Clarifying Questions
```
User: "create a pump agent"
AI: "Should this pump be automatic or manual control?"
```

### 3. Smart Defaults
```
User: "leak detector"
AI: Auto-configures threshold, sensitivity, alert settings
```

### 4. Conflict Resolution
```
User: "name it Sensor-A1"
AI: "That name exists. How about Sensor-A1-v2?"
```

---

## Acceptance Criteria

- âœ… AI understands natural language agent descriptions
- âœ… Asks intelligent clarifying questions
- âœ… Suggests appropriate agent types
- âœ… Generates valid agent configurations
- âœ… Handles multi-turn conversations
- âœ… Validates and prevents conflicts
- âœ… Creates agents successfully from AI-generated config
- âœ… Provides helpful suggestions and examples
- âœ… Gracefully handles ambiguous requests
- âœ… Learns from agency-specific patterns

---

## Technical Implementation

### Directory Structure
```
/workspaces/CodeValdCortex/
â”œâ”€â”€ internal/ai/
â”‚   â”œâ”€â”€ agent_creator.go              # AI agent creation logic
â”‚   â”œâ”€â”€ llm_client.go                 # LLM API integration
â”‚   â”œâ”€â”€ prompts/
â”‚   â”‚   â”œâ”€â”€ agent_creation.txt        # Prompt templates
â”‚   â”‚   â””â”€â”€ configuration.txt         # Config generation prompts
â”‚   â””â”€â”€ knowledge/
â”‚       â”œâ”€â”€ agent_types.json          # Agent type knowledge base
â”‚       â””â”€â”€ templates.json            # Configuration templates
â”œâ”€â”€ internal/web/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ ai_agent_creator.templ    # Chat interface
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â””â”€â”€ ai_agent_handler.go       # AI chat endpoints
â”‚   â””â”€â”€ components/
â”‚       â””â”€â”€ chat_message.templ        # Message components
â””â”€â”€ static/
    â”œâ”€â”€ css/
    â”‚   â””â”€â”€ ai-chat.css               # Chat UI styles
    â””â”€â”€ js/
        â”œâ”€â”€ ai-chat.js                # Chat interactions
        â””â”€â”€ streaming-response.js     # Real-time AI responses
```

---

## AI Prompt Engineering

### System Prompt
```
You are an expert AI assistant for creating agents in the CodeValdCortex 
multi-agent system. Your role is to help users create perfectly configured 
agents through natural conversation.

Agency Context: {agency_name} - {agency_category}
Available Agent Types: {agent_types}
Existing Agents: {agent_count}

Guidelines:
1. Ask clarifying questions for ambiguous requests
2. Suggest appropriate agent types based on description
3. Provide sensible defaults for optional fields
4. Validate against existing agent names
5. Be concise but helpful
6. Use emojis to make responses engaging
7. Always confirm before creating the agent

When ready to create, output JSON:
{
  "name": "agent-name",
  "type": "agent-type",
  "config": {...},
  "metadata": {...}
}
```

---

## API Specification

### Chat Endpoint
```json
POST /api/v1/agencies/{agency_id}/agents/chat
Content-Type: application/json

Request:
{
  "message": "I need a sensor to monitor pipe pressure in Zone A",
  "conversation_id": "conv-uuid-123",
  "context": {
    "previous_messages": [...],
    "draft_config": {...}
  }
}

Response (200 OK):
{
  "message": "Great! I'll help you create a pressure monitoring sensor...",
  "suggestions": ["Pressure-Sensor-Zone-A", "Zone-A-Pressure-01"],
  "questions": ["What pressure threshold should trigger alerts?"],
  "draft_config": {
    "type": "sensor",
    "category": "pressure",
    "location": "Zone A"
  },
  "confidence": 0.95,
  "ready_to_create": false
}
```

### Create Agent Endpoint
```json
POST /api/v1/agencies/{agency_id}/agents/create
Content-Type: application/json

Request:
{
  "config": {...},  // AI-generated configuration
  "conversation_id": "conv-uuid-123"
}

Response (201 Created):
{
  "agent_id": "agent-uuid-456",
  "name": "Pressure-Monitor-A1",
  "status": "created"
}
```

---

## Dependencies

- MVP-025 (agency selection and context)
- LLM API access (OpenAI, Claude, or local model)
- Agent type registry populated
- Streaming response support for real-time AI feedback

---

## Future Enhancements

- Voice input for agent creation
- Visual agent builder (AI-assisted drag-and-drop)
- Bulk agent creation from descriptions
- Agent cloning with AI modifications
- Multi-language support
- AI-powered agent optimization suggestions
- Learning from user corrections and preferences
