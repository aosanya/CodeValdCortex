# MVP-045: RACI Matrix UI Editor

**Status**: Not Started  
**Priority**: P1 (Critical)  
**Effort**: Medium  
**Skills Required**: Go, Templ, Frontend Dev  
**Dependencies**: MVP-044 (Agent Types UI Module)

---

## Objective

Build an interactive RACI (Responsible, Accountable, Consulted, Informed) matrix editor with visual role assignments, validation rules, templates, and integration with work items.

---

## Key Deliverables

### 1. RACI Data Models

```go
type RACIMatrix struct {
    Key          string           `json:"key"`
    AgencyID     string           `json:"agency_id"`
    WorkItemKey  string           `json:"work_item_key,omitempty"`  // Optional: link to specific work item
    Name         string           `json:"name"`
    Activities   []RACIActivity   `json:"activities"`
    Roles        []string         `json:"roles"`          // List of role names
    CreatedAt    time.Time        `json:"created_at"`
    UpdatedAt    time.Time        `json:"updated_at"`
}

type RACIActivity struct {
    ID          string              `json:"id"`
    Name        string              `json:"name"`
    Description string              `json:"description"`
    Assignments map[string]RACIRole `json:"assignments"` // role_name -> RACI role
}

type RACIRole string
const (
    Responsible RACIRole = "R"  // Does the work
    Accountable RACIRole = "A"  // Ultimately answerable
    Consulted   RACIRole = "C"  // Provides input
    Informed    RACIRole = "I"  // Kept in the loop
)
```

### 2. Visual RACI Matrix Editor

```html
<!-- Interactive RACI Matrix -->
<div class="raci-matrix-container">
  <table class="table is-striped is-hoverable is-fullwidth raci-table">
    <thead>
      <tr>
        <th style="width: 30%">Activity</th>
        <th>Project Manager</th>
        <th>Tech Lead</th>
        <th>Developer</th>
        <th>QA Engineer</th>
        <th style="width: 80px">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr class="activity-row">
        <td>
          <strong>Requirements Gathering</strong>
          <p class="help is-size-7">Define project requirements</p>
        </td>
        <td class="role-cell">
          <div class="raci-selector">
            <button class="raci-btn" data-role="R">R</button>
            <button class="raci-btn active" data-role="A">A</button>
            <button class="raci-btn" data-role="C">C</button>
            <button class="raci-btn" data-role="I">I</button>
            <button class="raci-btn-clear" title="Clear">✕</button>
          </div>
        </td>
        <td class="role-cell">
          <div class="raci-selector">
            <button class="raci-btn" data-role="R">R</button>
            <button class="raci-btn" data-role="A">A</button>
            <button class="raci-btn active" data-role="C">C</button>
            <button class="raci-btn" data-role="I">I</button>
            <button class="raci-btn-clear" title="Clear">✕</button>
          </div>
        </td>
        <!-- More role cells -->
        <td>
          <div class="buttons are-small">
            <button class="button is-small" title="Edit"><i class="fas fa-edit"></i></button>
            <button class="button is-small" title="Delete"><i class="fas fa-trash"></i></button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
  
  <div class="buttons">
    <button class="button is-primary" onclick="addActivity()">
      <span class="icon"><i class="fas fa-plus"></i></span>
      <span>Add Activity</span>
    </button>
    <button class="button" onclick="addRole()">
      <span class="icon"><i class="fas fa-user-plus"></i></span>
      <span>Add Role</span>
    </button>
  </div>
</div>
```

### 3. RACI Validation Engine

#### Validation Rules
- **Rule 1**: Each activity must have exactly ONE Accountable (A)
- **Rule 2**: Each activity must have at least ONE Responsible (R)
- **Rule 3**: Warn if no Consulted (C) or Informed (I) roles

#### Features
- Real-time validation with visual feedback
- Validation error display with specific guidance
- Prevent saving invalid RACI matrices

### 4. Role Management

- Add/remove roles dynamically
- Rename roles
- Role descriptions
- Default roles template (Project Manager, Tech Lead, Developer, QA, etc.)

### 5. Activity Management

- Add/remove activities
- Edit activity name and description
- Reorder activities (drag-and-drop)
- Activity templates by work item type
- Import activities from work items

### 6. RACI Templates

Predefined templates for common scenarios:
- **Software Development Project**
- **Research & Analysis**
- **Infrastructure Deployment**
- **Testing & QA**
- **Change Management**

Features:
- Template application with customization
- Save custom templates for reuse

### 7. Backend Services

- `RACIService` interface and implementation
- CRUD operations for RACI matrices
- Validation service with detailed error reporting
- Template management service
- Export service (PDF, Markdown, JSON)

### 8. API Endpoints

```
GET    /api/v1/agencies/{id}/raci-matrices
POST   /api/v1/agencies/{id}/raci-matrices
PUT    /api/v1/agencies/{id}/raci-matrices/{key}
DELETE /api/v1/agencies/{id}/raci-matrices/{key}
POST   /api/v1/agencies/{id}/raci-matrices/{key}/validate # Validate matrix
GET    /api/v1/agencies/{id}/raci-templates               # RACI templates
GET    /api/v1/agencies/{id}/raci-matrices/{key}/export/pdf      # Export to PDF
GET    /api/v1/agencies/{id}/raci-matrices/{key}/export/markdown # Export to Markdown
GET    /api/v1/agencies/{id}/raci-matrices/{key}/export/json     # Export to JSON
```

### 9. Validation Feedback UI

```html
<!-- Validation Summary -->
<div class="notification is-warning" id="raci-validation-warnings">
  <p class="has-text-weight-bold">⚠️ RACI Validation Issues:</p>
  <ul>
    <li>Activity "Design Architecture" has no Accountable (A) role assigned</li>
    <li>Activity "Code Review" has multiple Accountable (A) roles</li>
    <li>Activity "Testing" has no Responsible (R) role</li>
  </ul>
  <p class="help mt-2">
    Fix these issues before saving. Each activity must have exactly one Accountable 
    and at least one Responsible role.
  </p>
</div>
```

### 10. Export Functionality

#### Export to PDF
- Professional RACI matrix table
- Color-coded role assignments (R/A/C/I)
- Activity descriptions included
- Validation status indicator
- Agency branding and formatting
- Page layout optimized for readability

#### Export to Markdown
- Markdown table format
- GitHub/GitLab compatible
- ASCII symbols for RACI roles
- Role legends and descriptions
- Easy to embed in documentation

#### Export to JSON
- Complete RACI matrix structure
- All activities and assignments
- Role definitions
- Validation results
- Import/backup capability

---

## Acceptance Criteria

- [ ] Users can create and edit RACI matrices
- [ ] Click-to-assign RACI roles works smoothly
- [ ] Real-time validation enforces RACI rules
- [ ] Visual feedback for validation errors
- [ ] Activities and roles can be added/removed dynamically
- [ ] Templates can be applied and customized
- [ ] Export to PDF generates formatted RACI matrix
- [ ] Export to Markdown creates table format
- [ ] Export to JSON produces complete matrix structure
- [ ] RACI matrices can be linked to work items
- [ ] Role descriptions are editable
- [ ] Drag-and-drop reordering of activities
- [ ] RACI matrices are agency-scoped
- [ ] Color coding for different RACI roles

---

## Implementation Notes

**File Locations**:
```
/workspaces/CodeValdCortex/
├── internal/
│   ├── agency/
│   │   ├── raci_service.go
│   │   └── raci_validator.go
│   └── web/
│       ├── pages/
│       │   └── raci_matrix.templ
│       └── handlers/
│           └── raci_handler.go
└── static/
    ├── css/
    │   └── raci-matrix.css
    └── js/
        └── raci-matrix.js
```

**Integration Points**:
- Links to work items from MVP-043
- Export system reuses infrastructure from other modules
- Templates stored in database for reuse across agency
- Validation service can be extended for custom rules
