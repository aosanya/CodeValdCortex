# MVP-043: Work Items UI Module

**Status**: Not Started  
**Priority**: P1 (Critical)  
**Effort**: Medium  
**Skills Required**: Go, Templ, Frontend Dev, HTMX  
**Dependencies**: MVP-029 (Goals Module - provides foundation patterns)

---

## Objective

Build a complete Work Items management interface in the Agency Designer with CRUD operations, AI-powered refinement, smart templates, deliverables and dependencies management, and advanced filtering capabilities.

---

## Key Deliverables

### 1. Work Items Data Model

```go
type WorkItem struct {
    Key             string            `json:"key"`              // e.g., "WI-001"
    AgencyID        string            `json:"agency_id"`
    Title           string            `json:"title"`
    Description     string            `json:"description"`
    Type            WorkItemType      `json:"type"`             // Task, Feature, Epic, etc.
    Priority        Priority          `json:"priority"`         // P0, P1, P2, P3
    Status          WorkItemStatus    `json:"status"`           // Not Started, In Progress, Done
    Deliverables    []string          `json:"deliverables"`
    Dependencies    []string          `json:"dependencies"`     // References to other work item keys
    EstimatedEffort string            `json:"estimated_effort"` // e.g., "2 weeks", "40 hours"
    AssignedTo      string            `json:"assigned_to,omitempty"`
    Tags            []string          `json:"tags,omitempty"`
    CreatedAt       time.Time         `json:"created_at"`
    UpdatedAt       time.Time         `json:"updated_at"`
}
```

### 2. Work Items List View

- Table/card view of all work items
- Filtering by status, priority, type, tags
- Search functionality
- Sortable columns (priority, status, created date)
- Bulk operations (delete, update status)
- Quick actions (edit, delete, duplicate)
- Color coding by priority and status

### 3. Work Item Editor (Modal/Form)

- Title and description fields
- Type selector (Task, Feature, Epic, Bug, Research)
- Priority selector (P0-P3)
- Status selector with workflow
- Deliverables list editor (add/remove/reorder)
- Dependencies selector (dropdown of existing work items)
- Estimated effort input
- Tags input (multi-select or comma-separated)
- Auto-generate work item key (WI-001, WI-002, etc.)

### 4. AI Refinement Integration

Following the Introduction Card Pattern:

```html
<!-- Work Item Editor with AI Sparkle Button -->
<div class="box" id="workitem-editor-box">
  <div id="workitem-content">
    <div class="field">
      <label class="label">Description</label>
      <textarea id="workitem-description" class="textarea" rows="4"></textarea>
    </div>
    
    <div class="field">
      <label class="label">Deliverables</label>
      <textarea id="workitem-deliverables" class="textarea" rows="3"></textarea>
    </div>
    
    <div class="buttons is-right">
      <button class="button is-primary" onclick="saveWorkItem()">
        <span class="icon"><i class="fas fa-save"></i></span>
        <span>Save</span>
      </button>
      
      <!-- AI Refine Button (HTMX powered) -->
      <button class="button is-info"
              hx-post="/api/v1/agencies/{id}/work-items/{key}/refine"
              hx-include="#workitem-description, #workitem-deliverables"
              hx-target="#workitem-content"
              hx-indicator="#ai-process-status">
        <span class="icon"><i class="fas fa-magic"></i></span>
        <span>Refine with AI</span>
      </button>
    </div>
  </div>
</div>
```

### 5. Dependencies Visualization

- Visual dependency graph
- Dependency validation (prevent circular dependencies)
- Highlight blocking work items
- Suggest logical sequencing

### 6. Backend Services

- `WorkItemService` interface and implementation
- CRUD operations with agency-scoped access
- Auto-numbering for work item keys
- Dependency cycle detection
- Work item templates management
- Export service (PDF, Markdown, JSON generation)

### 7. API Endpoints

```
GET    /api/v1/agencies/{id}/work-items
POST   /api/v1/agencies/{id}/work-items
PUT    /api/v1/agencies/{id}/work-items/{key}
DELETE /api/v1/agencies/{id}/work-items/{key}
POST   /api/v1/agencies/{id}/work-items/{key}/refine      # AI refinement
GET    /api/v1/agencies/{id}/work-items/templates         # Work item templates
POST   /api/v1/agencies/{id}/work-items/validate-deps     # Validate dependencies
GET    /api/v1/agencies/{id}/work-items/export/pdf        # Export to PDF
GET    /api/v1/agencies/{id}/work-items/export/markdown   # Export to Markdown
GET    /api/v1/agencies/{id}/work-items/export/json       # Export to JSON
```

### 8. Template System

- Predefined work item templates by type
- Templates include suggested deliverables
- Context-aware template suggestions
- Save custom templates

### 9. Export Functionality

#### Export to PDF
- Professional formatted document
- Table of work items with all details
- Dependency graph visualization
- Agency branding (logo, colors)
- Page numbers and table of contents

#### Export to Markdown
- Well-structured markdown format
- GitHub/GitLab compatible
- Work items as tables
- Dependencies as lists
- Easy to version control

#### Export to JSON
- Complete data export
- Structured format for API integration
- Includes all metadata
- Import/backup capability

#### Export UI
- Export button with dropdown menu
- Select format (PDF/Markdown/JSON)
- Preview before export
- Batch export multiple work items

---

## Acceptance Criteria

- [ ] Users can create, edit, and delete work items
- [ ] Work item keys auto-generate uniquely (WI-001, WI-002, etc.)
- [ ] Filtering and search work correctly
- [ ] Dependencies can be added and validated
- [ ] AI refinement improves descriptions and suggests deliverables
- [ ] No circular dependencies allowed
- [ ] Deliverables are editable as list items
- [ ] Work items are agency-scoped
- [ ] Real-time validation feedback
- [ ] Export to PDF generates professional document
- [ ] Export to Markdown creates valid markdown file
- [ ] Export to JSON produces valid JSON structure

---

## Implementation Notes

**File Locations**:
```
/workspaces/CodeValdCortex/
├── internal/
│   ├── agency/
│   │   └── work_item_service.go
│   └── web/
│       ├── pages/
│       │   └── work_items.templ
│       └── handlers/
│           └── work_items_handler.go
└── static/
    ├── css/
    │   └── work-items.css
    └── js/
        └── work-items.js
```

**Integration Points**:
- Reuses AI refinement pattern from MVP-029 (Goals Module)
- Integrates with agency context and selection
- Connects to export service infrastructure
