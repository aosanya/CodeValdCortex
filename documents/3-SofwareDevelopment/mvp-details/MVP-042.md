# MVP-042: AI-Powered Agency Creator

**Status**: Not Started  
**Priority**: P1  
**Estimated Effort**: 8 days  
**Dependencies**: MVP-029 (Goals Module - completed), MVP-047 (Export System)

---

## Objective

Implement a comprehensive AI-driven agency creation flow that allows users to upload text documents (RFPs, SOWs, specifications), select which agency design areas to generate, and batch-generate complete agency designs including introduction, goals, work items, roles, and RACI matrices.

---

## Key Deliverables

### 1. Text Upload & Parsing

```go
type SourceDocument struct {
    DocumentID   string    `json:"document_id"`
    Filename     string    `json:"filename"`
    ContentType  string    `json:"content_type"`
    TextContent  string    `json:"text_content"`
    UploadedAt   time.Time `json:"uploaded_at"`
    ProcessedAt  time.Time `json:"processed_at"`
}
```

- **File Upload Interface**: Support PDF, DOCX, TXT, MD formats
- **Text Extraction**: Preprocessing and document structure analysis
- **Context Extraction**: Prepare content for AI prompts

### 2. Generation Selection Interface

- **Checkbox-based Selection** for generation areas:
  * ‚òëÔ∏è Introduction (background, purpose, scope)
  * ‚òëÔ∏è Goals (structured goal catalog with SMART format)
  * ‚òëÔ∏è Work Items (breakdown with deliverables, dependencies)
  * ‚òëÔ∏è Roles (roles, capabilities, specifications)
  * ‚òëÔ∏è RACI Matrix (responsibility assignments)
- Preview available source text
- Configure generation parameters (detail level, formality, etc.)
- Batch or individual generation modes

### 3. AI Generation Engine

```go
type GenerationRequest struct {
    AgencyID     string              `json:"agency_id"`
    SourceText   string              `json:"source_text"`
    Areas        []GenerationArea    `json:"areas"`
    Options      GenerationOptions   `json:"options"`
}

type GenerationArea string
const (
    AreaIntroduction GenerationArea = "introduction"
    AreaGoals        GenerationArea = "goals"
    AreaWorkItems    GenerationArea = "work_items"
    AreaAgentTypes   GenerationArea = "agent_types"
    AreaRACIMatrix   GenerationArea = "raci_matrix"
)

type GenerationOptions struct {
    DetailLevel  string `json:"detail_level"` // brief, standard, detailed
    Formality    string `json:"formality"`    // casual, professional, formal
    AgencyType   string `json:"agency_type"`  // context for generation
}
```

### 4. Batch AI Processing

- Parallel generation of selected areas
- Progress tracking for each area
- Error handling and retry logic
- Streaming results as they complete
- Validation of generated content

### 5. Generated Content Review & Edit

- Side-by-side view: Source text | Generated content
- Edit generated content before saving
- Regenerate individual sections
- Accept/reject individual items
- Bulk operations (accept all, reject all)

### 6. Agency Design Organization

Separate tabs/sections in Agency Designer:
- üìÑ **Introduction**
- üéØ **Goals**
- üìã **Work Items**
- ü§ñ **Roles**
- üìä **RACI Matrix**

Features:
- Navigation between sections
- Completion indicators per section
- Save progress at any point

### 7. Integration with Existing Modules

- Reuse Introduction module (MVP-025 - completed)
- Reuse Goals module (MVP-029 - completed)
- Integrate with Work Items module (MVP-030)
- Connect to Roles system
- Link to RACI Matrix editor (MVP-033)

### 8. API Endpoints

```
POST   /api/v1/agencies/{id}/upload-document
POST   /api/v1/agencies/{id}/generate/batch
GET    /api/v1/agencies/{id}/generation-status
POST   /api/v1/agencies/{id}/generate/introduction
POST   /api/v1/agencies/{id}/generate/goals
POST   /api/v1/agencies/{id}/generate/work-items
POST   /api/v1/agencies/{id}/generate/agent-types
POST   /api/v1/agencies/{id}/generate/raci-matrix
```

---

## UI Components

### Agency Creation Wizard

```html
<!-- Agency Creator Wizard -->
<div class="agency-creator-wizard">
  <!-- Step 1: Upload Source Document -->
  <div class="wizard-step" id="step-upload">
    <h2 class="title is-4">Step 1: Upload Source Document</h2>
    <div class="file has-name is-fullwidth">
      <label class="file-label">
        <input class="file-input" type="file" 
               accept=".pdf,.doc,.docx,.txt,.md"
               id="source-document">
        <span class="file-cta">
          <span class="file-icon">üìÅ</span>
          <span class="file-label">Choose a file‚Ä¶</span>
        </span>
        <span class="file-name" id="filename">
          No file selected
        </span>
      </label>
    </div>
    <div class="notification is-info is-light mt-4">
      <p><strong>Tip:</strong> Upload an RFP, SOW, specification document, 
         or any text describing your agency's purpose and requirements.</p>
    </div>
    
    <!-- Document Preview -->
    <div class="box mt-4" id="document-preview" style="display: none;">
      <h3 class="subtitle is-6">Document Preview</h3>
      <div class="content preview-text" style="max-height: 300px; overflow-y: auto;">
        <!-- Extracted text shown here -->
      </div>
    </div>
  </div>

  <!-- Step 2: Select Generation Areas -->
  <div class="wizard-step" id="step-select">
    <h2 class="title is-4">Step 2: Select What to Generate</h2>
    <div class="box">
      <label class="checkbox is-block mb-3">
        <input type="checkbox" name="areas" value="introduction" checked>
        <strong>üìÑ Introduction</strong>
        <p class="help">Generate agency background, purpose, and scope</p>
      </label>
      
      <label class="checkbox is-block mb-3">
        <input type="checkbox" name="areas" value="goals" checked>
        <strong>üéØ Goals</strong>
        <p class="help">Generate structured SMART goals catalog</p>
      </label>
      
      <label class="checkbox is-block mb-3">
        <input type="checkbox" name="areas" value="work_items" checked>
        <strong>üìã Work Items</strong>
        <p class="help">Generate work breakdown with deliverables and dependencies</p>
      </label>
      
      <label class="checkbox is-block mb-3">
        <input type="checkbox" name="areas" value="agent_types">
        <strong>ü§ñ Roles</strong>
        <p class="help">Generate agent roles and specifications</p>
      </label>
      
      <label class="checkbox is-block mb-3">
        <input type="checkbox" name="areas" value="raci_matrix">
        <strong>üìä RACI Matrix</strong>
        <p class="help">Generate responsibility assignments</p>
      </label>
    </div>
    
    <!-- Generation Options -->
    <div class="box mt-4">
      <h3 class="subtitle is-6">Generation Options</h3>
      <div class="field">
        <label class="label">Detail Level</label>
        <div class="control">
          <div class="select">
            <select name="detail_level">
              <option value="brief">Brief</option>
              <option value="standard" selected>Standard</option>
              <option value="detailed">Detailed</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="field">
        <label class="label">Formality</label>
        <div class="control">
          <div class="select">
            <select name="formality">
              <option value="casual">Casual</option>
              <option value="professional" selected>Professional</option>
              <option value="formal">Formal</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Step 3: Generation Progress -->
  <div class="wizard-step" id="step-generate">
    <h2 class="title is-4">Step 3: Generating Your Agency Design</h2>
    
    <div class="generation-progress">
      <!-- Introduction -->
      <div class="box generation-item" data-area="introduction">
        <div class="level">
          <div class="level-left">
            <div class="level-item">
              <span class="icon"><i class="fas fa-file-alt"></i></span>
            </div>
            <div class="level-item">
              <strong>Introduction</strong>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <span class="tag is-warning">In Progress</span>
              <span class="icon ml-2">
                <i class="fas fa-spinner fa-spin"></i>
              </span>
            </div>
          </div>
        </div>
        <progress class="progress is-small is-primary" value="65" max="100">65%</progress>
      </div>
      
      <!-- Goals -->
      <div class="box generation-item" data-area="goals">
        <div class="level">
          <div class="level-left">
            <div class="level-item">
              <span class="icon"><i class="fas fa-bullseye"></i></span>
            </div>
            <div class="level-item">
              <strong>Goals</strong>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <span class="tag is-success">Complete</span>
              <span class="icon ml-2 has-text-success">
                <i class="fas fa-check-circle"></i>
              </span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Work Items -->
      <div class="box generation-item" data-area="work_items">
        <div class="level">
          <div class="level-left">
            <div class="level-item">
              <span class="icon"><i class="fas fa-tasks"></i></span>
            </div>
            <div class="level-item">
              <strong>Work Items</strong>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <span class="tag is-light">Waiting</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Step 4: Review & Edit -->
  <div class="wizard-step" id="step-review">
    <h2 class="title is-4">Step 4: Review & Edit Generated Content</h2>
    
    <div class="tabs is-boxed">
      <ul>
        <li class="is-active"><a data-tab="introduction">üìÑ Introduction</a></li>
        <li><a data-tab="goals">üéØ Goals</a></li>
        <li><a data-tab="work-items">üìã Work Items</a></li>
        <li><a data-tab="agent-types">ü§ñ Roles</a></li>
        <li><a data-tab="raci">üìä RACI Matrix</a></li>
      </ul>
    </div>
    
    <div class="tab-content">
      <div class="columns">
        <div class="column">
          <h3 class="subtitle is-6">Source Text</h3>
          <div class="box source-text" style="max-height: 500px; overflow-y: auto;">
            <!-- Original text shown here -->
          </div>
        </div>
        <div class="column">
          <h3 class="subtitle is-6">Generated Content</h3>
          <div class="box generated-content" style="max-height: 500px; overflow-y: auto;">
            <!-- Generated content shown here (editable) -->
            <div class="buttons">
              <button class="button is-small is-primary">
                <span class="icon"><i class="fas fa-save"></i></span>
                <span>Save Changes</span>
              </button>
              <button class="button is-small is-warning">
                <span class="icon"><i class="fas fa-sync"></i></span>
                <span>Regenerate</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Wizard Navigation -->
  <div class="wizard-navigation buttons is-right mt-5">
    <button class="button" id="btn-prev">
      <span class="icon"><i class="fas fa-arrow-left"></i></span>
      <span>Previous</span>
    </button>
    <button class="button is-primary" id="btn-next">
      <span>Next</span>
      <span class="icon"><i class="fas fa-arrow-right"></i></span>
    </button>
    <button class="button is-success" id="btn-finish" style="display: none;">
      <span class="icon"><i class="fas fa-check"></i></span>
      <span>Finish & Save Agency</span>
    </button>
  </div>
</div>
```

---

## Backend Services

```go
// AIAgencyGeneratorService
type AIAgencyGeneratorService interface {
    UploadDocument(ctx context.Context, agencyID string, file io.Reader, filename string) (*SourceDocument, error)
    GenerateBatch(ctx context.Context, req GenerationRequest) (*GenerationResult, error)
    GenerateIntroduction(ctx context.Context, agencyID, sourceText string, opts GenerationOptions) (string, error)
    GenerateGoals(ctx context.Context, agencyID, sourceText string, opts GenerationOptions) ([]Goal, error)
    GenerateWorkItems(ctx context.Context, agencyID, sourceText string, opts GenerationOptions) ([]WorkItem, error)
    GenerateAgentTypes(ctx context.Context, agencyID, sourceText string, opts GenerationOptions) ([]AgentType, error)
    GenerateRACIMatrix(ctx context.Context, agencyID, sourceText string, workItems []WorkItem, opts GenerationOptions) (*RACIMatrix, error)
    GetGenerationStatus(ctx context.Context, agencyID, generationID string) (*GenerationStatus, error)
}

// Document processing utilities
type DocumentProcessor interface {
    ExtractText(file io.Reader, contentType string) (string, error)
    AnalyzeStructure(text string) (*DocumentStructure, error)
    ChunkForAI(text string, maxTokens int) ([]string, error)
}
```

---

## AI Prompt Templates

Each generation area should have specialized prompts:

### 1. Introduction Generation
- Extract background, purpose, scope
- Identify stakeholders
- Determine success criteria

### 2. Goals Generation
- Extract objectives from source
- Structure as SMART goals
- Categorize by type (Efficiency, Quality, Innovation, etc.)

### 3. Work Items Generation
- Break down into actionable items
- Generate deliverables per item
- Identify dependencies
- Estimate effort

### 4. Roles Generation
- Identify required roles
- Define capabilities per role
- Specify autonomy levels
- Determine communication patterns

### 5. RACI Matrix Generation
- Map work items to activities
- Assign roles to activities
- Ensure RACI validation rules

---

## Acceptance Criteria

- [ ] Document upload supports PDF, DOCX, TXT, MD formats
- [ ] Text extraction works correctly for all formats
- [ ] Checkbox selection allows any combination of areas
- [ ] Batch generation processes multiple areas in parallel
- [ ] Progress tracking shows real-time status
- [ ] Generated content is editable before saving
- [ ] Regeneration of individual areas works
- [ ] Side-by-side comparison view functional
- [ ] All generated content validates against schemas
- [ ] Agency Designer organized into clear sections
- [ ] Navigation between sections smooth
- [ ] Integration with existing modules seamless
- [ ] Error handling and retry logic robust
- [ ] Generation completes within reasonable time (<2 min per area)

---

## Implementation Notes

### Integration Patterns
- Follow existing introduction module (MVP-025) for structure
- Reuse goals module (MVP-029) API patterns
- Maintain consistency with completed features

### Performance Considerations
- Parallel generation for faster completion
- Streaming responses for real-time progress updates
- Chunking large documents to fit AI context windows
- Caching extracted text to avoid re-processing

### Error Handling
- Graceful degradation if generation fails for one area
- Retry logic with exponential backoff
- Clear error messages for users
- Partial save capability (save successful generations even if some fail)

### Document Processing
- Support for multiple file formats requires different parsers
- Text cleaning and preprocessing for better AI results
- Structure detection to extract sections/headings
- Token counting to fit within AI model limits
