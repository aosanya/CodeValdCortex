# MVP-044: Roles UI Module

**Status**: Not Started  
**Priority**: P1 (Critical)  
**Effort**: Medium  
**Skills Required**: Go, Templ, Frontend Dev  
**Dependencies**: MVP-043 (Work Items UI Module)

---

## Objective

Build a comprehensive Roles definition and management interface allowing users to define, categorize, and configure different types of agents that will be used in their agency.

---

## Key Deliverables

### 1. Role Data Model

```go
type AgentType struct {
    Key              string            `json:"key"`               // e.g., "AT-001"
    AgencyID         string            `json:"agency_id"`
    Name             string            `json:"name"`              // e.g., "Sensor Agent"
    Category         string            `json:"category"`          // Monitor, Controller, Analyzer, etc.
    Description      string            `json:"description"`
    Capabilities     []string          `json:"capabilities"`      // List of what this agent can do
    AutonomyLevel    AutonomyLevel     `json:"autonomy_level"`   // Manual, SemiAutomated, FullyAutomated
    RequiredSkills   []string          `json:"required_skills,omitempty"`
    TokenBudget      int64             `json:"token_budget"`      // Total token budget for all agents of this type
    Configuration    map[string]string `json:"configuration,omitempty"` // Key-value config params
    Icon             string            `json:"icon,omitempty"`    // Font Awesome icon or emoji
    Color            string            `json:"color,omitempty"`   // For UI visualization
    CreatedAt        time.Time         `json:"created_at"`
    UpdatedAt        time.Time         `json:"updated_at"`
}

type AutonomyLevel string
const (
    ManualControl      AutonomyLevel = "manual"
    SemiAutomated      AutonomyLevel = "semi_automated"
    FullyAutomated     AutonomyLevel = "fully_automated"
)
```

### 2. Roles Catalog View

- Grid/card layout of roles
- Visual representation with icons and colors
- Category grouping
- Search and filter by category
- Quick view of capabilities
- Add new role button

### 3. Role Editor Form

- Name and description fields
- Category selector (Monitor, Controller, Analyzer, Coordinator, Reporter)
- Autonomy level selector (Manual, Semi-Automated, Fully Automated)
- **Token Budget input** (total tokens for all agents of this type)
- Capabilities list editor (add/remove capabilities)
- Required skills multi-select
- Configuration parameters (key-value pairs editor)
- Icon picker (emoji or Font Awesome)
- Color picker for visual identification
- Preview of role card

### 4. Token Budget Management

- Each role has a total token budget
- All agents of this type collectively cannot exceed this budget
- Individual agents have their own token budgets (must be ≤ role budget)
- Budget enforcement happens at runtime
- Admin page allows budget configuration and monitoring
- Visual indicators show budget utilization (e.g., progress bars)
- Alerts when approaching budget limits (80%, 90%, 100%)

### 5. Role Templates

Predefined templates for common roles:
- **Sensor Agent** (monitoring, data collection)
- **Controller Agent** (actuation, control logic)
- **Analyzer Agent** (data analysis, pattern detection)
- **Coordinator Agent** (workflow orchestration)
- **Reporter Agent** (reporting, dashboards)

Features:
- Template application with customization
- Industry-specific templates (water, logistics, healthcare, etc.)

### 6. Capability Management

- Predefined capability library
- Custom capability creation
- Capability descriptions and examples
- Capability validation

### 7. Backend Services

- `AgentTypeService` interface and implementation
- CRUD operations with agency-scoped access
- Auto-numbering for role keys
- Template management
- Capability library management

### 8. API Endpoints

```
GET    /api/v1/agencies/{id}/roles
POST   /api/v1/agencies/{id}/roles
PUT    /api/v1/agencies/{id}/roles/{key}
DELETE /api/v1/agencies/{id}/roles/{key}
GET    /api/v1/agencies/{id}/roles/templates       # Agent type templates
GET    /api/v1/capabilities                              # Capability library
GET    /api/v1/agencies/{id}/roles/export/pdf      # Export catalog to PDF
GET    /api/v1/agencies/{id}/roles/export/markdown # Export catalog to Markdown
GET    /api/v1/agencies/{id}/roles/export/json     # Export catalog to JSON
```

### 9. Export Functionality

#### Export to PDF
- Agent types catalog with visual cards
- Detailed specifications per role
- Capability matrices
- Token budget allocations
- Professional formatting with agency branding

#### Export to Markdown
- Structured documentation format
- Agent type hierarchy
- Capability tables
- Easy to include in documentation repos

#### Export to JSON
- Complete role definitions
- API-ready format
- Includes all configuration and metadata
- Import/backup capability

### 10. UI Components

```html
<!-- Role Card in Catalog -->
<div class="card agent-type-card" style="border-left: 4px solid {color}">
  <div class="card-content">
    <div class="media">
      <div class="media-left">
        <span class="icon is-large">{icon}</span>
      </div>
      <div class="media-content">
        <p class="title is-5">{name}</p>
        <p class="subtitle is-6">{category}</p>
      </div>
    </div>
    <div class="content">
      <p>{description}</p>
      <div class="tags">
        {#each capabilities}
          <span class="tag is-info">{capability}</span>
        {/each}
      </div>
      <p class="is-size-7">
        <span class="tag is-light">{autonomy_level}</span>
      </p>
    </div>
  </div>
  <footer class="card-footer">
    <a class="card-footer-item" onclick="editAgentType('{key}')">Edit</a>
    <a class="card-footer-item" onclick="duplicateAgentType('{key}')">Duplicate</a>
    <a class="card-footer-item has-text-danger" onclick="deleteAgentType('{key}')">Delete</a>
  </footer>
</div>
```

---

## Acceptance Criteria

- [ ] Users can create, edit, and delete roles
- [ ] Agent type keys auto-generate uniquely (AT-001, AT-002, etc.)
- [ ] Category filtering and search work correctly
- [ ] Templates can be applied and customized
- [ ] Capabilities can be added from library or custom created
- [ ] Icon and color pickers functional
- [ ] Visual catalog displays roles clearly
- [ ] Agent types are agency-scoped
- [ ] Export to PDF generates professional roles catalog
- [ ] Export to Markdown creates structured documentation
- [ ] Export to JSON produces complete role definitions
- [ ] Validation prevents duplicate names
- [ ] Token budget field is editable and validated
- [ ] Token budget warnings displayed when approaching limits

---

## Implementation Notes

**File Locations**:
```
/workspaces/CodeValdCortex/
├── internal/
│   ├── agency/
│   │   ├── agent_type_service.go
│   │   └── capability_service.go
│   └── web/
│       ├── pages/
│       │   └── agent_types.templ
│       └── handlers/
│           └── agent_types_handler.go
└── static/
    ├── css/
    │   └── roles.css
    └── js/
        └── roles.js
```

**Integration Points**:
- Token budgets integrate with MVP-046 (Agency Admin page)
- Capability library shared across all role definitions
- Export system reuses infrastructure from MVP-043
- Templates stored in database for reuse
