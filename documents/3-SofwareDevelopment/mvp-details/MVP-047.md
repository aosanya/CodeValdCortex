# MVP-047: Agency Designer Export System

**Status**: Not Started  
**Priority**: P1 (Critical)  
**Effort**: Medium  
**Skills Required**: Go, PDF Generation, File Export  
**Dependencies**: MVP-045 (RACI Matrix UI Editor)

---

## Objective

Implement a comprehensive export system that allows users to export the complete agency design or individual sections to PDF, Markdown, and JSON formats with customizable templates, branding options, and professional formatting.

---

## Key Deliverables

### 1. Export System Architecture

```go
type ExportRequest struct {
    AgencyID       string          `json:"agency_id"`
    Format         ExportFormat    `json:"format"`         // PDF, Markdown, JSON
    Sections       []ExportSection `json:"sections"`       // What to include
    Options        ExportOptions   `json:"options"`        // Customization options
}

type ExportFormat string
const (
    FormatPDF      ExportFormat = "pdf"
    FormatMarkdown ExportFormat = "markdown"
    FormatJSON     ExportFormat = "json"
)

type ExportSection string
const (
    SectionIntroduction ExportSection = "introduction"
    SectionGoals        ExportSection = "goals"
    SectionWorkItems    ExportSection = "work_items"
    SectionAgentTypes   ExportSection = "agent_types"
    SectionRACIMatrix   ExportSection = "raci_matrix"
    SectionAll          ExportSection = "all"
)

type ExportOptions struct{
    IncludeBranding    bool     `json:"include_branding"`
    TableOfContents    bool     `json:"table_of_contents"`
    PageNumbers        bool     `json:"page_numbers"`
    ColorScheme        string   `json:"color_scheme"`
    Template           string   `json:"template"`
    CustomLogo         string   `json:"custom_logo,omitempty"`
}
```

### 2. PDF Export Features

#### Professional Document Layout
- Cover page with agency name and logo
- Table of contents with page numbers
- Section headers and footers
- Agency branding (colors, logo)
- Page numbering

#### Section-Specific Formatting
- **Introduction**: Executive summary format
- **Goals**: Categorized goal tables
- **Work Items**: Gantt-style visualization, dependency graphs
- **Roles**: Visual catalog with icons
- **RACI Matrix**: Professional matrix table

#### PDF Generation Options
- Multiple templates (Executive, Technical, Detailed)
- Custom branding
- Embedded images and diagrams
- Hyperlinked table of contents

### 3. Markdown Export Features

#### Structured Documentation
- Well-formatted headers (H1, H2, H3)
- Tables for structured data
- Code blocks for technical details
- Lists for itemized content

#### GitHub/GitLab Compatible
- GitHub Flavored Markdown (GFM)
- Proper table syntax
- Task lists for work items
- Emoji support

#### Version Control Friendly
- Clean, readable format
- Easy to diff
- Suitable for documentation repos
- Can be rendered by static site generators

### 4. JSON Export Features

#### Complete Data Export
- All agency design data
- Structured format
- Includes metadata and timestamps
- Relationships and references preserved

#### API-Ready Format
- Valid JSON schema
- Suitable for API integration
- Import capability
- Backup and restore support

#### Selective Export
- Export specific sections
- Filter by criteria (date, status, etc.)
- Include/exclude certain fields

### 5. Export UI Components

See full UI mockup in main MVP file (lines 2735-2850)

### 6. Backend Export Services

- `ExportService` interface and implementation
- PDF generation service (using library like wkhtmltopdf or pdfkit)
- Markdown generation service
- JSON serialization service
- Template rendering engine
- Branding customization service
- File storage and download management

### 7. API Endpoints

```
POST   /api/v1/agencies/{id}/export                # Export with options
GET    /api/v1/agencies/{id}/export/pdf            # Quick PDF export (all sections)
GET    /api/v1/agencies/{id}/export/markdown       # Quick Markdown export
GET    /api/v1/agencies/{id}/export/json           # Quick JSON export
GET    /api/v1/agencies/{id}/export/templates      # Available export templates
GET    /api/v1/agencies/{id}/export/{exportId}     # Download previously generated export
GET    /api/v1/agencies/{id}/export/history        # Export history
```

### 8. Export Templates

#### Executive Summary Template (PDF)
- High-level overview
- Key goals and metrics
- Minimal technical details
- Board/stakeholder friendly

#### Technical Documentation Template (PDF)
- Complete technical specifications
- Detailed work item breakdowns
- Agent type specifications
- RACI matrices
- Architecture diagrams

#### Detailed Specification Template (PDF)
- Comprehensive documentation
- All fields and metadata
- Dependencies and relationships
- Timeline and resource allocation

### 9. Export History & Management

- Track all exports (who, when, what format)
- Re-download previous exports
- Export versioning
- Audit trail for compliance
- Auto-cleanup of old exports

### 10. Branding Customization

- Upload custom logo
- Configure color scheme
- Set header/footer content
- Custom cover page template
- Watermark options

---

## Acceptance Criteria

- [ ] Export modal displays all format and section options
- [ ] PDF export generates professional document with branding
- [ ] Markdown export creates valid, well-formatted markdown
- [ ] JSON export produces complete, valid JSON structure
- [ ] Users can select specific sections to export
- [ ] Export templates work correctly
- [ ] Branding options (logo, colors) apply to PDF exports
- [ ] Table of contents and page numbers work in PDF
- [ ] Export history tracks all exports
- [ ] Previously generated exports can be re-downloaded
- [ ] File downloads work reliably
- [ ] Export preview shows accurate information
- [ ] All agency sections export correctly
- [ ] Dependency graphs and visualizations included in PDF

---

## Implementation Notes

**File Locations**:
```
/workspaces/CodeValdCortex/
├── internal/
│   ├── export/
│   │   ├── export_service.go
│   │   ├── pdf_generator.go
│   │   ├── markdown_generator.go
│   │   └── json_generator.go
│   └── web/
│       ├── pages/
│       │   └── export_modal.templ
│       └── handlers/
│           └── export_handler.go
└── static/
    └── templates/
        ├── executive_summary.html
        ├── technical_docs.html
        └── detailed_spec.html
```

**Integration Points**:
- Aggregates data from all Agency Designer modules (MVP-029, 043, 044, 045)
- Uses agency branding settings
- Connects to file storage system for downloads
- Audit logging for export events
